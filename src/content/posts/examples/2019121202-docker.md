---
title: Dockerå¸¸ç”¨å‘½ä»¤ä¸æ“ä½œ
cover: \Docker_logo.png
indexing: true
toc: æ˜¯å¦é¡¯ç¤ºtoc ï¼ˆé™¤éç‰¹å®šæ–‡ç« è¨­ç½®ï¼Œå¯ä»¥ä¸å¯«ï¼‰
toc_number: æ˜¯å¦é¡¯ç¤ºtocæ•¸å­— ï¼ˆé™¤éç‰¹å®šæ–‡ç« è¨­ç½®ï¼Œå¯ä»¥ä¸å¯«ï¼‰
copyright: æ˜¯å¦é¡¯ç¤ºç‰ˆæ¬Š ï¼ˆé™¤éç‰¹å®šæ–‡ç« è¨­ç½®ï¼Œå¯ä»¥ä¸å¯«ï¼‰
comments: true
tags:
  - Docker
categories:
  - Docker
abbrlink: a476
date: 2019-12-12 22:10:03
top:
keywords:
description:
password: ""
theme: xray
---

# åŸºç¡€ç±»

## æŸ¥çœ‹dockerä¿¡æ¯

```bash
# æŸ¥çœ‹dockerç‰ˆæœ¬
docker version
# æ˜¾ç¤ºdockerç³»ç»Ÿçš„ä¿¡æ¯
docker info
# æ—¥å¿—ä¿¡æ¯
docker logs
# æ•…éšœæ£€æŸ¥
service docker status
# å¯åŠ¨å…³é—­docker
sudo service docker start|stop
```

# æ—¥å¿—ç±»

## æŸ¥çœ‹å®¹å™¨æ—¥å¿—

```bash
docker logs -f <å®¹å™¨åorID>
```

## docker daemon æ—¥å¿—ä½ç½®

ä¹Ÿç§°ä¹‹ä¸º `å¼•æ“æ—¥å¿—` æ ¹æ®ç³»ç»Ÿä¸åŒå„ä¸ç›¸åŒ

```bash
* CoreOS - journalctl -u docker.service
* Ubuntu(16.04) - journalctl -u docker.service
* Ubuntu(14.04) - /var/log/upstart/docker.log
* Boot2Docker - /var/log/docker.log
* Debian GNU/Linux 8 - journalctl -u docker.service
* Debian GNU/Linux 7 - /var/log/daemon.log
* CentOS 7/RHEL 7 - journalctl -u docker.service
* CentOS - /var/log/daemon.log | grep docker
* Fedora - journalctl -u docker.service
* OpenSuSE - journalctl -u docker.service
* Red Hat Enterprise Linux Server - /var/log/messages | grep docker
* OSX - ~/Library/Containers/com.docker.docker/Data/com.docker.driver.amd64-linux/log/docker.log
```

## journalctl æ—¥å¿—å·¥å…·ä½¿ç”¨

```bash
# æœ€åè¡Œæ•°çš„æ—¥å¿—
journalctl -n
# è¯¦ç»†ä¿¡æ¯
journalctl -f
# æœ¬æ¬¡å¯åŠ¨åçš„æ‰€æœ‰æ—¥å¿—
journalctl -b
# æŸ¥çœ‹å¯åŠ¨è®°å½•
journalctl --list-boots
# æŸ¥çœ‹æŸæ¬¡è¿è¡Œè¿‡ç¨‹ä¸­çš„æ—¥å¿—
sudo journalctl -b [å¯åŠ¨é¡ºåºå·ï¼Œæˆ–è€…å¯åŠ¨hash]
# æŸ¥çœ‹è®°å½•ä¸­æŒ‡å®šå•å…ƒ docker.service çš„æ—¥å¿—
journalctl -u docker.service
```

- æ˜¾ç¤ºå¯ä»¥åŒ¹é…æ—¥å¿—çº§åˆ«

```bash
journalctl -F PRIORITY
```

| ç¼–ç  | ä¼˜å…ˆçº§  | ä¸¥é‡æ€§           |
| ---- | ------- | ---------------- |
| 0    | emerg   | ç³»ç»Ÿä¸å¯ç”¨       |
| 1    | alert   | å¿…é¡»ç«‹å³é‡‡å–æªæ–½ |
| 2    | crit    | ä¸¥é‡çŠ¶å†µ         |
| 3    | err     | éä¸¥é‡é”™è¯¯çŠ¶å†µ   |
| 4    | warning | è­¦å‘ŠçŠ¶å†µ         |
| 5    | notice  | æ­£å¸¸ä½†é‡è¦çš„äº‹ä»¶ |
| 6    | info    | ä¿¡æ¯æ€§äº‹ä»¶       |
| 7    | debug   | è°ƒè¯•çº§åˆ«æ¶ˆæ¯     |

æ¯”å¦‚æ˜¾ç¤º docker å†…æ ¸æ—¥å¿—ä¸­ info ç±»çš„æ•°æ®

```bash
# åªæ˜¾ç¤ºé”™è¯¯ã€å†²çªå’Œé‡è¦å‘Šè­¦ä¿¡æ¯
journalctl -u docker.service -p err..alert
# -p ç­‰æ•ˆäº PRIORITY ä¹Ÿå¯ä»¥ç”¨æ•°å­—æ¥è¡¨ç¤º
journalctl -u docker.service PRIORITY=6
# è¿˜å¯ä»¥åŠ å…¥ MESSAGEã€MESSAGE_IDã€_PIDã€_UIDã€_HOSTNAMEã€_SYSTEMD_UNIT ç­‰æ¡ä»¶
# æŸ¥è¯¢å­—æ®µ `man 7 systemd.journal-fields`
# ä¾‹å¦‚æŸ¥è¯¢ info ä¿¡æ¯ï¼ŒPID ä¸º 2331
journalctl -u docker.service PRIORITY=6 _PID=2331
```

## journalctl æ—¥å¿—ä¿å­˜åˆ°æ–‡ä»¶

> systemd-journald æœåŠ¡æ”¶é›†åˆ°çš„æ—¥å¿—é»˜è®¤ä¿å­˜åœ¨ /run/log ç›®å½•ä¸­ï¼Œé‡å¯ç³»ç»Ÿä¼šä¸¢æ‰ä»¥å‰çš„æ—¥å¿—ä¿¡æ¯

- ä¿å­˜æ—¥å¿—åˆ°é»˜è®¤é…ç½®ç›®å½•

åˆ›å»ºç›®å½• `/var/log/journal` ï¼Œå½“è¿™ä¸ªç›®å½•å­˜åœ¨ï¼Œåˆ™æ—¥å¿—ä¼šæŒä¹…åŒ–ï¼Œè®°å¾—åˆ›å»ºåï¼Œé‡å¯ `systemd-journald.service` æœåŠ¡

```bash
sudo mkdir /var/log/journal
sudo chown root:systemd-journal /var/log/journal
sudo chmod 2775 /var/log/journal
sudo systemctl restart systemd-journald.service
```

- æˆ–è€…ä¿®æ”¹é…ç½®

ä¿®æ”¹ `/etc/systemd/journald.conf`ï¼ŒæŠŠå–æ¶ˆæ³¨é‡Š `Storage=auto`, å¹¶æ”¹ä¸º `Storage=persistent`
 é‡å¯ `systemd-journald.service` æœåŠ¡

- æŸ¥çœ‹æ—¥å¿—å ç”¨çš„ç£ç›˜ç©ºé—´

```bash
sudo journalctl --disk-usage
```

å®¹é‡å®šä¹‰æ–‡ä»¶åœ¨ `/etc/systemd/journald.conf`
 æ—¥å¿—è°ƒæ•´æ–‡ä»¶ `/etc/logrotate.conf`

> æ—¥å¿—ç³»ç»ŸåŒæ ·ä¼šè¿›è¡Œè½®è½¬ï¼Œæ¯æœˆè§¦å‘ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ—¥å¿—å¤§å°ä¸èƒ½è¶…è¿‡æ‰€å¤„æ–‡ä»¶ç³»ç»Ÿçš„10%ï¼Œä¹Ÿä¸å¯ä½¿æ‰€å¤„æ–‡ä»¶ç³»ç»Ÿç©ºé—´ä½äº15%
>
> > æ— è®ºæ˜¯å¦è®¾ç½®æŠŠæ—¥å¿—å­˜å‚¨åˆ°æ–‡ä»¶ï¼Œéƒ½ä¼šå¾—åˆ° disk-usage çš„å ç”¨ç©ºé—´ï¼

- æ¸…ç†æ—¥å¿—æ•°æ®

```bash
#ä½¿ç”¨ â€“vacuum-size é€‰é¡¹æŒ‡å®šæ—¥å¿—çš„æ€»ä½“ä½“ç§¯
sudo journalctl --vacuum-size=1G
ä½¿ç”¨ â€“vacuum-time é€‰é¡¹æŒ‡å®šæ—¥å¿—çš„æ€»æ—¶é—´å ç”¨
sudo journalctl --vacuum-time=1years
```

æ›´å¤šè¯¦ç»†è§ ğŸ‘‰[linux journalctl å‘½ä»¤](http://www.cnblogs.com/sparkdev/p/8795141.html)

## docker ps æ²¡æœ‰å“åº” æ—¥å¿—æŸ¥è¯¢

```bash
# grep æ‰€æœ‰å®¹å™¨çš„config.json
docker logs [conID]
# ç¡®è®¤é—®é¢˜å
# è¯¥config.json ä¸­æœ‰è¯¥å®¹å™¨1å·è¿›ç¨‹çš„pid
kill -9 pid
```

# å®¹å™¨ç±»

dockerå®¹å™¨å¯ä»¥ç†è§£ä¸ºåœ¨æ²™ç›’ä¸­è¿è¡Œçš„è¿›ç¨‹

> è¿™ä¸ªæ²™ç›’åŒ…å«äº†è¯¥è¿›ç¨‹è¿è¡Œæ‰€å¿…é¡»çš„èµ„æºï¼ŒåŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿã€ç³»ç»Ÿç±»åº“ã€shell ç¯å¢ƒç­‰ç­‰ã€‚ä½†è¿™ä¸ªæ²™ç›’é»˜è®¤æ˜¯ä¸ä¼šè¿è¡Œä»»ä½•ç¨‹åºçš„ã€‚ä½ éœ€è¦åœ¨æ²™ç›’ä¸­è¿è¡Œä¸€ä¸ªè¿›ç¨‹æ¥å¯åŠ¨æŸä¸€ä¸ªå®¹å™¨ã€‚è¿™ä¸ªè¿›ç¨‹æ˜¯è¯¥å®¹å™¨çš„å”¯ä¸€è¿›ç¨‹ï¼Œæ‰€ä»¥å½“è¯¥è¿›ç¨‹ç»“æŸçš„æ—¶å€™ï¼Œå®¹å™¨ä¹Ÿä¼šå®Œå…¨çš„åœæ­¢ã€‚

## æŸ¥çœ‹å®¹å™¨ä¿¡æ¯

```bash
# æŸ¥çœ‹å½“å‰è¿è¡Œçš„å®¹å™¨
docker ps
# æŸ¥çœ‹å…¨éƒ¨å®¹å™¨
docker ps -a
# æŸ¥çœ‹å…¨éƒ¨å®¹å™¨çš„idå’Œä¿¡æ¯
docker ps -a -q
# æŸ¥çœ‹å…¨éƒ¨å®¹å™¨å ç”¨çš„ç©ºé—´
docker ps -as
# æŸ¥çœ‹ä¸€ä¸ªæ­£åœ¨è¿è¡Œå®¹å™¨è¿›ç¨‹ï¼Œæ”¯æŒ ps å‘½ä»¤å‚æ•°
docker top
# æŸ¥çœ‹å®¹å™¨çš„ç¤ºä¾‹id
sudo docker inspect -f  '{{.Id}}' [id]
# æ£€æŸ¥é•œåƒæˆ–è€…å®¹å™¨çš„å‚æ•°ï¼Œé»˜è®¤è¿”å› JSON æ ¼å¼
docker inspect
# è¿”å› ubuntu:14.04  é•œåƒçš„ docker ç‰ˆæœ¬
docker inspect --format '{{.DockerVersion}}' ubuntu:14.04
docker inspect --format='{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' ubuntu:14.04
```

## å®¹å™¨åŒæ­¥å‘½ä»¤

```sh
# ä¿å­˜å¯¹å®¹å™¨çš„ä¿®æ”¹
docker commit
# ä¿å­˜æŸä¸ªå®¹å™¨æˆä¸ºä¸€ä¸ªé•œåƒ
docker commit -a "user" -m "commit info" [CONTAINER] [imageName]:[imageTag]
# æ¨é€ä¸€ä¸ªå®¹å™¨åˆ°ä¸­å¿ƒä»“åº“
docker login --username=[userName] --password=[pwd] [registryURL]
## å»ºè®®ç™»å½•åæŸ¥çœ‹ docker info
docker tag [imageID] [remoteURL]:[imageTag]
docker push [remoteURL]:[imageTag]
# æ‹‰å–æäº¤çš„å®¹å™¨
docker pull [remoteURL]:[imageTag]
# å¯¹æ¯”å®¹å™¨çš„æ”¹åŠ¨
docker diff
# é™„åŠ åˆ°ä¸€ä¸ªè¿è¡Œçš„å®¹å™¨ä¸Š
docker attach
```

## å®¹å™¨æ“ä½œå‘½ä»¤

### åˆ›å»ºåˆ é™¤å®¹å™¨

```bash
# åˆ›å»ºä¸€ä¸ªå®¹å™¨å‘½åä¸º test ä½¿ç”¨é•œåƒdaocloud.io/library/ubuntu
docker create -it --name test daocloud.io/library/ubuntu
# åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå®¹å™¨ åä¸º test ä½¿ç”¨é•œåƒdaocloud.io/library/ubuntu
docker run --name test daocloud.io/library/ubuntu
# åˆ é™¤ä¸€ä¸ªå®¹å™¨
docker rm [å®¹å™¨id]
# åˆ é™¤æ‰€æœ‰å®¹å™¨
docker rm `docker ps -a -q`
# æ ¹æ®Dockerfile æ„å»º
docker build -t [image_name] [Dockerfile_path]
```

### dockerå®¹å™¨éšç³»ç»Ÿè‡ªå¯

```bash
docker run --restart=always
```

- `no` â€“ é»˜è®¤å€¼ï¼Œå¦‚æœå®¹å™¨æŒ‚æ‰ä¸è‡ªåŠ¨é‡å¯
- `on-failure` â€“ å½“å®¹å™¨ä»¥é 0 ç é€€å‡ºæ—¶é‡å¯å®¹å™¨,åŒæ—¶å¯æ¥å—ä¸€ä¸ªå¯é€‰çš„æœ€å¤§é‡å¯æ¬¡æ•°å‚æ•° (e.g. on-failure:10).
- `always` â€“ ä¸ç®¡é€€å‡ºç æ˜¯å¤šå°‘éƒ½è¦é‡å¯

### å®¹å™¨èµ„æºé™åˆ¶å‚æ•°

```bash
# é™åˆ¶å†…å­˜æœ€å¤§ä½¿ç”¨
-m 1024m --memory-swap=1024m
# é™åˆ¶å®¹å™¨ä½¿ç”¨CPU
--cpuset-cpus="0,1"
```

### æŠŠä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨ä¿å­˜ä¸ºé•œåƒ

```bash
docker commit <CONTAIN-ID> <IMAGE-NAME>
```

### å¯åŠ¨åœæ­¢å®¹å™¨ç­‰æ“ä½œ

```bash
docker start|stop|restart [id]
# æš‚åœ|æ¢å¤ æŸä¸€å®¹å™¨çš„æ‰€æœ‰è¿›ç¨‹
docker pause|unpause [id]
# æ€æ­»ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡å®šå®¹å™¨è¿›ç¨‹
docker kill -s KILL [id]
# åœæ­¢å…¨éƒ¨è¿è¡Œçš„å®¹å™¨
docker stop `docker ps -q`
# æ€æ‰å…¨éƒ¨è¿è¡Œçš„å®¹å™¨
docker kill -s KILL `docker ps -q`
```

### äº¤äº’å¼è¿›å…¥å®¹å™¨

```bash
sudo docker exec -it {{containerName or containerID}} bash
sudo docker exec -i {{containerName or containerID}} bash
sudo docker exec -t {{containerName or containerID}} bash
sudo docker exec -d {{containerName or containerID}} bash
```

- åªç”¨ `-i` å‚æ•°ï¼Œç”±äºæ²¡æœ‰åˆ†é…ä¼ªç»ˆç«¯ï¼Œçœ‹èµ·æ¥åƒpipeæ‰§è¡Œä¸€æ ·ã€‚ä½†æ˜¯æ‰§è¡Œç»“æœã€å‘½ä»¤è¿”å›å€¼éƒ½å¯ä»¥æ­£ç¡®è·å–
- åªç”¨ `-t` å‚æ•°ï¼Œåˆ™å¯ä»¥çœ‹åˆ°ä¸€ä¸ª console çª—å£ï¼Œä½†æ˜¯æ‰§è¡Œå‘½ä»¤ä¼šå‘ç°ç”±äºæ²¡æœ‰è·å¾—stdinçš„è¾“å‡ºï¼Œæ— æ³•çœ‹åˆ°å‘½ä»¤æ‰§è¡Œæƒ…å†µ
- ä½¿ç”¨ `-it` æ—¶ï¼Œåˆ™å’Œæˆ‘ä»¬å¹³å¸¸æ“ä½œ console ç•Œé¢ç±»ä¼¼ï¼Œè€Œä¸”ä¹Ÿ`ä¸ä¼šåƒattachæ–¹å¼å› ä¸ºé€€å‡ºï¼Œå¯¼è‡´æ•´ä¸ªå®¹å™¨é€€å‡º`
- ä½¿ç”¨ `-d` å‚æ•°ï¼Œåœ¨åå°æ‰§è¡Œä¸€ä¸ªè¿›ç¨‹ã€‚å¦‚æœä¸€ä¸ªå‘½ä»¤éœ€è¦é•¿æ—¶é—´è¿›ç¨‹ï¼Œä¼šå¾ˆå¿«è¿”å›

#### Docker attach

Docker attachå¯ä»¥attachåˆ°ä¸€ä¸ªå·²ç»è¿è¡Œçš„å®¹å™¨çš„stdinï¼Œç„¶åè¿›è¡Œå‘½ä»¤æ‰§è¡Œçš„åŠ¨ä½œ

```bash
docker attach {{containerName or containerID}}
```

> éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä»è¿™ä¸ªstdinä¸­exitï¼Œä¼šå¯¼è‡´å®¹å™¨çš„åœæ­¢

### æŸ¥çœ‹å®¹å™¨çš„rootç”¨æˆ·å¯†ç 

```bash
docker logs <å®¹å™¨åorID> 2>&1 | grep '^User: ' | tail -n1
```

å› ä¸ºDockerå®¹å™¨å¯åŠ¨æ—¶çš„rootç”¨æˆ·çš„å¯†ç æ˜¯éšæœºåˆ†é…çš„ã€‚æ‰€ä»¥ï¼Œé€šè¿‡è¿™ç§æ–¹å¼å°±å¯ä»¥å¾—åˆ°å®¹å™¨çš„rootç”¨æˆ·çš„å¯†ç 

å®¹å™¨äºå®¿ä¸»æ‹·è´æ–‡ä»¶

```bash
docker cp [OPTIONS] CONTAINER:SRC_PATH DEST_PATH|-
docker cp [OPTIONS] SRC_PATH|- CONTAINER:DEST_PATH
# æœ¬åœ°æ–‡ä»¶ä¸Šä¼ åˆ°å¯¹åº”å®¹å™¨çš„ç›®å½•
docker cp local.sh [CONTAINERid]:[TagPath]
```

> æ­¤å‘½ä»¤ä¸ºé«˜ç‰ˆæœ¬dockeræ‰æœ‰ï¼Œå½“ç„¶1.11+è‚¯å®šåŒ…å«

### è¿è¡Œä¸€ä¸ªæ–°å®¹å™¨ï¼ŒåŒæ—¶ä¸ºå®ƒå‘½åã€ç«¯å£æ˜ å°„ã€æ–‡ä»¶å¤¹æ˜ å°„

ä»¥`redmine`é•œåƒä¸ºä¾‹

```bash
docker run --name redmine -p 9003:80 -p 9023:22 -d -v /var/redmine/files:/redmine/files -v /var/redmine/mysql:/var/lib/mysql sameersbn/redmine
```

### ä¸€ä¸ªå®¹å™¨è¿æ¥åˆ°å¦ä¸€ä¸ªå®¹å™¨

```bash
docker run -i -t --name sonar -d -link mmysql:db  tpires/sonar-server sonar
```

### å¯¼å…¥å¯¼å‡ºå®¹å™¨

```bash
# æ”¯æŒè¿œç¨‹æ–‡ä»¶ .tar, .tar.gz, .tgz, .bzip, .tar.xz, .txz
docker import
# å¯¼å‡º
docker export [id] >~/Downloads/ubuntu_nexus.tar
```

> å¯¼å‡ºåå¯¼å…¥ï¼ˆexported-imported)ï¼‰çš„å®¹å™¨ä¼šä¸¢å¤±æ‰€æœ‰çš„æäº¤å†å²ï¼Œæ— æ³•å›æ»šã€‚

# é•œåƒæ“ä½œ

## è¿œç¨‹é•œåƒ

```bash
docker login
```

```bash
docker search
# æœç´¢å¤„æ”¶è—æ•°ä¸å°äº 3 ï¼Œå¹¶ä¸”èƒ½å¤Ÿè‡ªåŠ¨åŒ–æ„å»ºçš„  django é•œåƒï¼Œå¹¶ä¸”å®Œæ•´æ˜¾ç¤ºé•œåƒæè¿°
docker search -s 3 --automated --no-trunc django
docker pull
# æ‹‰å–ubuntuæœ€æ–°çš„é•œåƒ
docker pull ubuntu:latest
# æœåŠ¡å™¨æ‹‰å–ä¸ªäººåŠ¨æ€ï¼Œå¯é€‰æ‹©æ—¶é—´åŒºé—´
docker events
# æ‹‰å–ä¸ªäººä» 2015/07/20 åˆ° 2015/08/08 çš„ä¸ªäººåŠ¨æ€
docker events --since="20150720" --until="20150808"
```

## é•œåƒåŒæ­¥æ“ä½œ

```bash
# æ ‡è®°æœ¬åœ°é•œåƒï¼Œå°†å…¶å½’å…¥æŸä¸€ä»“åº“
docker tag
# å°† ID ä¸º 5db5f84x1261 çš„å®¹å™¨æ ‡è®°ä¸º mine/lnmp:0.2 é•œåƒ
docker tag 5db5f84x1261 mine/lnmp:0.2
# å°†é•œåƒæ¨é€è‡³è¿œç¨‹ä»“åº“ï¼Œé»˜è®¤ä¸º Docker Hub
docker push
```

## æœ¬åœ°é•œåƒ

```bash
# åˆ—å‡ºæœ¬åœ°æ‰€æœ‰é•œåƒ
docker images
# æœ¬åœ°é•œåƒåä¸º ubuntu çš„æ‰€æœ‰é•œåƒ
docker images ubuntu
# æŸ¥çœ‹æŒ‡å®šé•œåƒçš„åˆ›å»ºå†å²
docker history [id]
# æœ¬åœ°ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡å®šçš„é•œåƒ
docker rmi
# ç§»é™¤æœ¬åœ°å…¨éƒ¨é•œåƒ
docker rmi `docker images -a -q`
# æŒ‡å®šé•œåƒä¿å­˜æˆ tar å½’æ¡£æ–‡ä»¶ï¼Œ docker load çš„é€†æ“ä½œ
docker save
# å°†é•œåƒ ubuntu:14.04 ä¿å­˜ä¸º ubuntu14.04.tar æ–‡ä»¶
docker save -o ubuntu14.04.tar ubuntu:14.04
# ä» tar é•œåƒå½’æ¡£ä¸­è½½å…¥é•œåƒï¼Œ docker save çš„é€†æ“ä½œ
docker load
# ä¸Šé¢å‘½ä»¤çš„æ„æ€æ˜¯å°† ubuntu14.04.tar æ–‡ä»¶è½½å…¥é•œåƒä¸­
docker load -i ubuntu14.04.tar
docker load < /home/save.tar
# æ„å»ºè‡ªå·±çš„é•œåƒ
docker build -t <é•œåƒå> <Dockerfileè·¯å¾„>
docker build -t xx/gitlab .
```

> ä¿å­˜åå†åŠ è½½ï¼ˆsaved-loadedï¼‰çš„é•œåƒä¸ä¼šä¸¢å¤±æäº¤å†å²å’Œå±‚ï¼Œå¯ä»¥å›æ»š

## é‡æ–°æŸ¥çœ‹containerçš„stdout

```bash
# å¯åŠ¨topå‘½ä»¤ï¼Œåå°è¿è¡Œ
$ ID=$(sudo docker run -d ubuntu /usr/bin/top -b)
# è·å–æ­£åœ¨runningçš„containerçš„è¾“å‡º
$ sudo docker attach $ID
top - 02:05:52 up  3:05,  0 users,  load average: 0.01, 0.02, 0.05
Tasks:  1 total,  1 running,  0 sleeping,  0 stopped,  0 zombie
Cpu(s):  0.1%us,  0.2%sy,  0.0%ni, 99.7%id,  0.0%wa,  0.0%hi,  0.0%si,  0.0%st
Mem:    373572k total,  355560k used,    18012k free,    27872k buffers
Swap:  786428k total,        0k used,  786428k free,  221740k cached
^C$
$ sudo docker stop $ID
```

# docker run

## åå°è¿è¡Œ(-d)ã€å¹¶æš´éœ²ç«¯å£

```bash
docker run -d -p 127.0.0.1:33301:22 centos6-ssh
```

## run å‘½ä»¤è¯¦è§£

```bash
-a, --attach=[]            Attach to STDIN, STDOUT or STDERR æŒ‡å®šæ ‡å‡†è¾“å…¥è¾“å‡ºå†…å®¹ç±»å‹ï¼Œå¯é€‰ STDIN/STDOUT/STDERR ä¸‰é¡¹
  --add-host=[]              Add a custom host-to-IP mapping (host:ip)
  --blkio-weight=0            Block IO (relative weight), between 10 and 1000
  -c, --cpu-shares=0          CPU shares (relative weight)
  --cap-add=[]                Add Linux capabilities
  --cap-drop=[]              Drop Linux capabilities
  --cgroup-parent=            Optional parent cgroup for the container
  --cidfile=                  Write the container ID to the file
  --cpu-period=0              Limit CPU CFS (Completely Fair Scheduler) period
  --cpu-quota=0              Limit the CPU CFS quota
  --cpuset-cpus=              CPUs in which to allow execution (0-3, 0,1) ç»‘å®šå®¹å™¨åˆ°æŒ‡å®šCPUè¿è¡Œ
  --cpuset-mems=              MEMs in which to allow execution (0-3, 0,1) ç»‘å®šå®¹å™¨åˆ°æŒ‡å®šMEMè¿è¡Œ
  -d, --detach=false          Run container in background and print container ID åå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨ID
  --device=[]                Add a host device to the container
  --dns=[]                    Set custom DNS servers æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„DNSæœåŠ¡å™¨ï¼Œé»˜è®¤å’Œå®¿ä¸»ä¸€è‡´
  --dns-search=[]            Set custom DNS search domains æŒ‡å®šå®¹å™¨DNSæœç´¢åŸŸåï¼Œé»˜è®¤å’Œå®¿ä¸»ä¸€è‡´
  -e, --env=[]                Set environment variables è®¾ç½®ç¯å¢ƒå˜é‡
  --entrypoint=              Overwrite the default ENTRYPOINT of the image
  --env-file=[]              Read in a file of environment variables ä»æŒ‡å®šæ–‡ä»¶è¯»å…¥ç¯å¢ƒå˜é‡
  --expose=[]                Expose a port or a range of ports
  -h, --hostname=            Container host name æŒ‡å®šå®¹å™¨çš„hostname
  --help=false                Print usage
  -i, --interactive=false    Keep STDIN open even if not attached ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨ï¼Œé€šå¸¸ä¸ -t åŒæ—¶ä½¿ç”¨
  --ipc=                      IPC namespace to use
  -l, --label=[]              Set meta data on a container
  --label-file=[]            Read in a line delimited file of labels
  --link=[]                  Add link to another container
  --log-driver=              Logging driver for container
  --log-opt=[]                Log driver options
  --lxc-conf=[]              Add custom lxc options
  -m, --memory=              Memory limit
  --mac-address=              Container MAC address (e.g. 92:d0:c6:0a:29:33)
  --memory-swap=              Total memory (memory + swap), '-1' to disable swap
  --name=                    Assign a name to the container ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°
  --net=bridge                Set the Network mode for the container  æŒ‡å®šå®¹å™¨çš„ç½‘ç»œè¿æ¥ç±»å‹ï¼Œæ”¯æŒ bridge/host/none/container:<name|id> å››ç§ç±»å‹
  --oom-kill-disable=false    Disable OOM Killer
  -P, --publish-all=false    Publish all exposed ports to random ports
  -p, --publish=[]            Publish a container's port(s) to the host
  --pid=                      PID namespace to use
  --privileged=false          Give extended privileges to this container
  --read-only=false          Mount the container's root filesystem as read only
  --restart=no                Restart policy to apply when a container exits
  --rm=false                  Automatically remove the container when it exits
  --security-opt=[]          Security Options
  --sig-proxy=true            Proxy received signals to the process
  -t, --tty=false            Allocate a pseudo-TTY ä¸ºå®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯ï¼Œé€šå¸¸ä¸ -i åŒæ—¶ä½¿ç”¨
  -u, --user=                Username or UID (format: <name|uid>[:<group|gid>])
  --ulimit=[]                Ulimit options
  --uts=                      UTS namespace to use
  -v, --volume=[]            Bind mount a volume
  --volumes-from=[]          Mount volumes from the specified container(s)
  -w, --workdir=              Working directory inside the container
```

 ğŸ“–[å‚è€ƒ](https://www.jianshu.com/p/adaa34795e64)

------
